#!/usr/bin/env bash

set -euo pipefail

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# install curl if it is not already present
if ! command -v curl &> /dev/null; then
  sudo apt install -y curl
fi

# get the node version to install
NODE_VERSION=$(cat "${DIR}/../.node-version")

case "$(arch)" in
  aarch64)
    ARCH=arm64
    ;;

  x86_64)
    ARCH=x64
    ;;

  *)
    echo "Unsupported architecture: $(arch)"
    exit 1
    ;;
esac

DOWNLOAD_URL="https://nodejs.org/dist/v${NODE_VERSION}/node-v${NODE_VERSION}-linux-${ARCH}.tar.gz"

curl -sLo- "${DOWNLOAD_URL}" | sudo tar -xz -C /usr/local --strip-components=1

corepack enable
